# 2장 - 테스트

## Intro

### 두 번째 중요한 전략

* 에플리케이션은 계속 변하고 복잡해진다. 그 변화에 대응하기 위한 전략 2가지가 있다.
  * 첫째, 객체지향적 설계와 그것을 효과적으로 담을 IoC/DI 기술
  * 두번째, 만들어진 코드를 확신할 수 있게 해주고, 변화에 유연하게 대처할 수 있게 해주는 자신감을 주는 테스트
    * 또한 테스트는 스프링을 학습하는 데 있어 가장 효과적인 방법의 하나
    * 테스트의 작성은 스프링의 다양한 기술을 활용하는 방법을 이해하고 검증하고 실전에 적용하는 방법을 익히는 데 효과적임

### 2장의 내용

* 테스트란 무엇인가?
* 그 가치와 장점
* 활용전략
* 스프링과의 관계
* 테스트 프레임워크 소개
* 테스트 프레임워크를 이용한 학습전략

## 2.1. UserDaoTest 다시보기

* 웹을 통한 DAO 테스트 방법의 문제점
  * 보통 웹 에플리케이션 테스트 방식
    * DAO, Service, MVC 프레젠테이션 계층까지 대충 쭉 만듦
    * 서버에 배치
    * 웹 화면을 띄워 폼을 열고, 값을 입력한 뒤 버튼을 눌러 등록해봄
    * 에러가 없는지 확인
  * 이런 방식은... **모든것을 만들고 나서야 테스트가 가능하다는 점** 이 가장 큰 문제
  * 어디에서 문제가 발생했는지 찾기 힘듦. 테스트에 모든 계층이 참여하고 있기 때문
  * 그렇다면?

* 작은 단위의 테스트
  * 테스트 하고자 하는 대상에만 집중하여 테스트 하는 것이 바람직
    * 엉뚱하게 UserDao 기능을 돌려보려고 만든 JSP나 서블릿에 에러가 발생해서 그것을 찾으려고 시간낭비할 필요가 없음
  * unit test(단위 테스트) - 작은 단위의 코드에 대해 테스트를 수행한 것. 하나의 관심사에 집중
  * 지금까지 본 UserDaoTest도 일종의 단위 테스트라고 볼 수 있다.
    * UserDao라는 작은 단위의 기능만을 담당하기 때문
  * 물론 전 과정이 하나로 묶인 통합 테스트도 필요하다
    * 그렇지만 단위 테스트가 없이 통합 테스트에서 오류가 난다면 문제의 원인을 찾기 매우 힘들다.
    * 이미 각 단위별로 충분한 검증을 하고 있다면 오류를 찾는 범위가 훨씬 줄어든다.
  * 또한 개발자 본인이 자신의 로직을 빠르게 검증하는데도 단위 테스트가 필요하다.

* 자동 수행 테스트
  * 필요한 이유
    * 개발자의 특별한 개입없이 자동으로 수행되는 것이 효율적이다. 테스트 속도 - 컴퓨터 vs 인간
    * 사람은 반복행동을 4~5회만 해도 지친다.
    * 사람이 수동으로 테스트 결과를 판단하는 것은 실수할 가능성이 높다.
    * 자주 반복 가능 - 번거롭지 않고, 빠르게 실행가능하기 때문

* 지속적인 개선과 점짐적인 개발을 위한 테스트
  * 이미 검증 가능한 테스트가 있기 때문에 조금씩 코드를 개선해 나가는 것이 쉽다.
  * 변경후 테스트로 간단히 확인해보면 되기 때문
  * [개선 -> 테스트 -> 개선 -> 테스트 ...] 안정적이면서 빠르게 진행이 가능하다.

### 2.1.3 UserDaoTest의 문제점

* 수동 확인 작업의 번거로움
  * 테스트 수행작업과 입력 데이터 준비는 자동으로 되어 있음
  * 그러나 결과는 여전히 console 창의 결과를 사람의 눈으로 판단함
  * 이것 또한 검증할 양이 많아지면 사람의 눈으로 일일히 확인 불가능함
* 실행 작업의 번거로움
  * 즉각 실행가능한 main() 에 있지만 이런 Test용 클래스가 한 에플리케이션에 수백개라면?
  * 수백번 직접 실행해야함
  * 좀 더 체계적으로 간편하게 실행되는 것이 필요

## 2.2. UserDaoTest 의 개선

### 2.2.1. 테스트 검증의 자동화

* 모든 테스트의 결과는 3가지
  * 성공
  * 실패
    * 에러 발생
    * 결과가 기대한 것과 다름

* 에러발생은 비교적 명확히 알기 쉬움
  * jvm에서 호출스텍과 에러메시지가 상세히 출력됨
* 그러나 결과가 다른 것은 어떻게?
  * 기대한 결과가 나오는지 안나오는지 판정까지 필요함

### 2.2.2. 테스트의 효율적인 수행과 결과 관리

* JUnit - 이미 JAVA는 위에서 언급한 요구사항을 만족하는 단위 테스트를 위한 프레임워크가 존재
  * 일정한 패턴을 가진 테스트를 만들 수 있음
  * 많은 테스트를 간단히 실행 가능
  * 테스트 결과를 종합해서 볼수 있음
  * 테스트가 실패한 곳을 빠르게 찾을 수 있음

* JUnit으로 테스트 전환
  * 전환된 소스 참고
  * 기존 main() -> 테스트 메소드 전환(2가지 조건)
    * @Test 추가
    * public 선언
  * 검증 코드 전환
    * JUnit 이 제공하는 AssertThat 스테틱 메소드 이용
  * 실행 - 최근에는 IDE 에서 바로 실행 가능하게 지원함
  * 결과 출력 - IDE 에서 OK / Failures 로 통계 및 실패 위치 이동하도록 함
